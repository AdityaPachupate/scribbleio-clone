<!-- Timer -->
<div class="timer" *ngIf="gameStarted && !roundEnded">
  â±ï¸ {{ timeRemaining }}s
</div>

<!-- Leave Button -->
<button class="btn-leave" (click)="leaveRoom()">ğŸšª Leave</button>
<!-- ==================== LEFT SIDEBAR: PLAYERS ==================== -->
<div class="players-panel">
  <h3>Players ({{ players?.length || 0 }})</h3>
  
  <!-- Player List -->
  <div class="players-list">
    <div
      *ngFor="let player of players"
      class="player-card"
      [class.drawing]="player.isDrawing"
      [class.guessed]="player.hasGuessedCorrectly"
    >
      <div class="player-info">
        <span class="player-name">{{ player.username }}</span>
        <span class="player-status" *ngIf="player.isDrawing">âœï¸ Drawing</span>
        <span class="player-status correct" *ngIf="player.hasGuessedCorrectly && !player.isDrawing">
          âœ“ Guessed!
        </span>
      </div>
      <div class="player-score">{{ player.score }} pts</div>
    </div>
  </div>

  <!-- Start Game Button (only shown before game starts) -->
  <div class="game-controls" *ngIf="!gameStarted">
    <button class="btn-start" (click)="startGame()">
      ğŸ® Start Game
    </button>
    <p class="hint">Need at least 2 players</p>
  </div>
</div>

<!-- ==================== CENTER: CANVAS AREA ==================== -->
<div class="canvas-area">
  
  <!-- Word Display -->
  <div class="word-display" *ngIf="gameStarted && !roundEnded">
    <!-- Show actual word if it's your turn -->
    <div *ngIf="isMyTurn" class="your-word">
      <strong>Your word:</strong> {{ currentWord }}
    </div>
    
    <!-- Show masked word if you're guessing -->
    <div *ngIf="!isMyTurn" class="guess-word">
      <strong>Guess:</strong> {{ maskedWord }}
    </div>
  </div>

  <!-- Drawing Tools (only shown when it's your turn) -->
  <div class="tools-panel" *ngIf="isMyTurn && !roundEnded">
    <!-- Color Palette -->
    <div class="tool-section">
      <label>Color:</label>
      <div class="color-palette">
        <button
          *ngFor="let color of colors"
          class="color-btn"
          [style.background-color]="color"
          [class.selected]="selectedColor === color"
          (click)="selectColor(color)"
          [attr.aria-label]="'Select color ' + color"
        ></button>
      </div>
    </div>

    <!-- Brush Size -->
    <div class="tool-section">
      <label>Brush Size:</label>
      <div class="size-buttons">
        <button
          *ngFor="let width of lineWidths"
          class="size-btn"
          [class.selected]="selectedLineWidth === width"
          (click)="selectLineWidth(width)"
        >
          {{ width }}px
        </button>
      </div>
    </div>

    <!-- Clear Button -->
    <button class="btn-clear" (click)="clearCanvasClick()">
      ğŸ—‘ï¸ Clear
    </button>
  </div>

  <!-- Canvas Wrapper -->
  <div class="canvas-wrapper">
    <!-- Drawing Canvas -->
    <canvas
      #canvas
      width="800"
      height="500"
      (mousedown)="onMouseDown($event)"
      (mousemove)="onMouseMove($event)"
      (mouseup)="onMouseUp()"
      (mouseleave)="onMouseLeave()"
      [class.drawable]="isMyTurn"
    ></canvas>

    <!-- Waiting Overlay (before game starts) -->
    <div class="waiting-overlay" *ngIf="!gameStarted">
      <div class="waiting-content">
        <h2>ğŸ¨ Waiting to Start</h2>
        <p>Get ready to draw and guess!</p>
        <div class="waiting-animation">
          <div class="dot"></div>
          <div class="dot"></div>
          <div class="dot"></div>
        </div>
      </div>
    </div>

    <!-- Round End Overlay (after round ends) -->
    <div class="round-end-overlay" *ngIf="roundEnded">
      <div class="round-end-content">
        <h2>ğŸ‰ Round Over!</h2>
        
        <!-- Reveal the word -->
        <p class="reveal-word">
          The word was: <strong>{{ roundEndData?.word }}</strong>
        </p>
        
        <!-- Final Scores -->
        <div class="final-scores">
          <h3>Scores:</h3>
          <div class="score-list">
            <div 
              *ngFor="let player of roundEndData?.players; let i = index" 
              class="score-item"
              [class.first-place]="i === 0"
              [class.second-place]="i === 1"
              [class.third-place]="i === 2"
            >
              <span class="rank">
                <span *ngIf="i === 0">ğŸ¥‡</span>
                <span *ngIf="i === 1">ğŸ¥ˆ</span>
                <span *ngIf="i === 2">ğŸ¥‰</span>
                <span *ngIf="i > 2">{{ i + 1 }}.</span>
              </span>
              <span class="name">{{ player.username }}</span>
              <span class="score">{{ player.score }} pts</span>
            </div>
          </div>
        </div>

        <!-- Next Round Button -->
        <button class="btn-next-round" (click)="nextRound()">
          â–¶ï¸ Next Round
        </button>
      </div>
    </div>
  </div>
</div>

<!-- ==================== RIGHT SIDEBAR: CHAT ==================== -->
<div class="chat-panel">
  <h3>ğŸ’¬ Chat</h3>
  
  <!-- Chat Messages -->
  <div class="chat-messages">
    <div
      *ngFor="let msg of chatMessages"
      class="chat-message"
      [class.system]="msg.isSystemMessage"
      [class.correct]="msg.isCorrectGuess"
    >
      <span class="message-user" *ngIf="!msg.isSystemMessage">
        {{ msg.username }}:
      </span>
      <span class="message-text">{{ msg.message }}</span>
      <span class="message-time">
        {{ msg.timestamp | date:'shortTime' }}
      </span>
    </div>
    
    <!-- Empty state -->
    <div *ngIf="chatMessages.length === 0" class="chat-empty">
      <p>No messages yet. Start chatting!</p>
    </div>
  </div>

  <!-- Chat Input -->
  <div class="chat-input">
    <input
      type="text"
      [(ngModel)]="currentMessage"
      placeholder="Type your guess..."
      (keyup.enter)="sendMessage()"
      [disabled]="isMyTurn || !gameStarted || roundEnded"
      maxlength="200"
    />
    <button
      (click)="sendMessage()"
      [disabled]="isMyTurn || !gameStarted || roundEnded || !currentMessage.trim()"
      class="btn-send"
    >
      Send
    </button>
  </div>
  
  <!-- Chat hints -->
  <div class="chat-hints" *ngIf="gameStarted && !roundEnded">
    <p *ngIf="isMyTurn" class="hint-drawer">
      You can't guess while drawing!
    </p>
    <p *ngIf="!isMyTurn" class="hint-guesser">
      Type your guess and press Enter
    </p>
  </div>
</div>