<div class="game-container">
  <!-- Status Bar (Inspired by Skribbl.io) -->
  <header class="status-bar">
    <div class="status-left">
      <div class="timer-circle" *ngIf="gameStarted && !roundEnded">
        <span>{{ timeRemaining }}</span>
      </div>
      <div class="round-info">
        <span class="label">ROUND</span>
        <span class="value">{{ roundNumber }} / 3</span>
      </div>
    </div>

    <div class="status-center">
      <!-- Game Word / Hint -->
      <div class="word-container" *ngIf="gameStarted && !roundEnded">
        <div *ngIf="isMyTurn" class="word-hint">
          <span class="label">DRAW THIS:</span>
          <span class="word">{{ currentWord }}</span>
        </div>
        <div *ngIf="!isMyTurn" class="word-hint">
          <span class="word-masked">{{ maskedWord }}</span>
        </div>
      </div>
      <div class="waiting-title" *ngIf="!gameStarted">
        ðŸŽ¨ SKRIBBL.CLONE
      </div>
    </div>

    <div class="status-right">
      <div class="room-badges">
        <div class="badge-item you">
          <span class="label">YOU:</span>
          <span class="value">{{ username }}</span>
        </div>
        <div class="badge-item">
          <span class="label">ROOM:</span>
          <span class="value">{{ roomCode }}</span>
        </div>
        <div class="badge-item">
          <span class="label">HOST:</span>
          <span class="value">{{ hostName }}</span>
        </div>
      </div>
      <button class="btn-leave" (click)="leaveRoom()">LEAVE</button>
    </div>
  </header>

  <div class="game-main-layout">
    <!-- LEFT SIDEBAR: PLAYERS -->
    <aside class="players-sidebar">
      <div class="sidebar-header">PLAYERS</div>

      <!-- Player List -->
      <div class="players-list">
        <div *ngFor="let player of getPlayersSorted(); let i = index" class="player-card"
          [class.is-drawing]="player.isDrawing" [class.has-guessed]="player.hasGuessedCorrectly && !player.isDrawing">
          <div class="player-rank">{{ i + 1 }}</div>
          <div class="player-main">
            <span class="player-name">{{ player.username }}</span>
            <span class="player-status-tag" *ngIf="player.isDrawing">DRAWING...</span>
            <span class="player-status-tag success"
              *ngIf="player.hasGuessedCorrectly && !player.isDrawing">GUESSED!</span>
          </div>
          <div class="player-points">{{ player.score }}</div>
        </div>
      </div>
    </aside>

    <!-- CENTER: CANVAS AREA -->
    <main class="canvas-container">
      <!-- Drawing Tools (only shown when it's your turn) -->
      <div class="tools-bar" *ngIf="isMyTurn && !roundEnded">
        <!-- Color Palette -->
        <div class="tool-group colors">
          <div class="color-grid">
            <button *ngFor="let color of colors" class="color-dot" [style.background-color]="color"
              [class.active]="selectedColor === color" (click)="selectColor(color)"></button>
          </div>
        </div>

        <!-- Brush Size -->
        <div class="tool-group brushes">
          <button *ngFor="let width of lineWidths" class="size-dot" [class.active]="selectedLineWidth === width"
            (click)="selectLineWidth(width)" [style.width.px]="width + 8" [style.height.px]="width + 8">
          </button>
        </div>

        <!-- Clear Button -->
        <button class="btn-tool-clear" (click)="clearCanvasClick()">CLEAR</button>
      </div>

      <div class="canvas-board">
        <canvas #canvas width="1200" height="600" (mousedown)="onMouseDown($event)" (mousemove)="onMouseMove($event)"
          (mouseup)="onMouseUp()" (mouseleave)="onMouseLeave()" [class.can-draw]="isMyTurn"></canvas>

        <!-- Overlays (Waiting, Round End) -->
        <div class="overlay" *ngIf="!gameStarted">
          <div class="overlay-card">
            <h2>WAITING TO START...</h2>
            <div class="game-controls" *ngIf="isHost">
              <button class="btn-primary" (click)="startGame()">START GAME</button>
            </div>
            <p *ngIf="!isHost">The host will start the game soon!</p>
          </div>
        </div>

        <div class="overlay" *ngIf="roundEnded">
          <div class="overlay-card winner-card">
            <h2>ROUND OVER!</h2>
            <p class="answer">The word was: <strong>{{ roundEndData?.word }}</strong></p>
            <div class="standings">
              <div *ngFor="let player of roundEndData?.players; let i = index" class="standing-item">
                <span class="rank">{{ i + 1 }}</span>
                <span class="name">{{ player.username }}</span>
                <span class="score">{{ player.score }}</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </main>

    <!-- RIGHT SIDEBAR: CHAT -->
    <aside class="chat-sidebar">
      <div class="chat-header">CHAT</div>
      <div class="chat-feed" #chatMessagesContainer>
        <div *ngFor="let msg of chatMessages" class="chat-row" [class.sys]="msg.isSystemMessage"
          [class.hit]="msg.isCorrectGuess">
          <span class="chat-user" *ngIf="!msg.isSystemMessage">{{ msg.username }}:</span>
          <span class="chat-text">{{ msg.message }}</span>
        </div>
      </div>

      <div class="chat-input-area">
        <input type="text" [(ngModel)]="currentMessage" placeholder="Type your guess here..."
          (keyup.enter)="sendMessage()" [disabled]="isMyTurn || !gameStarted || roundEnded" />
      </div>
    </aside>
  </div>
</div>